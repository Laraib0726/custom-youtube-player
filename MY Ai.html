<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>My Live Lecture</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        margin: 20px;
        text-align: center;
      }
      #playerContainer {
        max-width: 800px;
        margin: 0 auto;
      }
      .controls, .inputs {
        margin-top: 10px;
      }
      .button {
        padding: 10px 20px;
        font-size: 16px;
        margin: 5px;
      }
      input[type="text"] {
        padding: 5px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <h1>My Live Lecture</h1>
    
    <!-- Container for the YouTube player -->
    <div id="playerContainer">
      <div id="player"></div>
    </div>
    
    <!-- Custom controls -->
    <div class="controls">
      <label for="speedControl">Playback Speed:</label>
      <select id="speedControl">
        <option value="0.5">0.5x</option>
        <option value="1" selected>1x (Normal)</option>
        <option value="1.5">1.5x</option>
        <option value="2">2x</option>
      </select>
      <button id="rewindButton" class="button">Rewind 10 Seconds</button>
    </div>
    
    <!-- Inputs for video URL and start time -->
    <div class="inputs">
      <div>
        <label for="urlInput">YouTube Video URL:</label>
        <input type="text" id="urlInput" size="50" placeholder="Enter YouTube URL here">
      </div>
      <div>
        <label for="startTimeInput">Start Time (hh:mm:ss):</label>
        <input type="text" id="startTimeInput" placeholder="e.g. 03:30:21">
      </div>
      <button id="loadUrlBtn" class="button">Load Video</button>
    </div>
    
    <!-- Load the YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
      var player;
      // liveTime will track the maximum time reached
      var liveTime = 0;
      
      // This function is called when the API is ready.
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '450',
          width: '800',
          videoId: 'QO-GfZEBxuY', // Default video ID (from your provided URL)
          playerVars: {
            'controls': 0,       // disable built-in controls
            'disablekb': 1,      // disable keyboard controls
            'modestbranding': 1,
            'rel': 0
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
      
      // When player is ready, start playing and update liveTime
      function onPlayerReady(event) {
        event.target.playVideo();
        updateLiveTime();
      }
      
      // When the player state changes, update liveTime if playing
      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
          updateLiveTime();
        }
      }
      
      // Update liveTime every second (this is our “live” boundary)
      function updateLiveTime() {
        setInterval(function() {
          var current = player.getCurrentTime();
          if (current > liveTime) {
            liveTime = current;
          }
        }, 1000);
      }
      
      // Playback speed control
      document.getElementById('speedControl').addEventListener('change', function() {
        var newSpeed = parseFloat(this.value);
        player.setPlaybackRate(newSpeed);
        console.log("Playback speed set to:", newSpeed + "x");
      });
      
      // Rewind button event: rewind 10 seconds
      document.getElementById('rewindButton').addEventListener('click', function() {
        var currentTime = player.getCurrentTime();
        var newTime = Math.max(0, currentTime - 10);
        player.seekTo(newTime, true);
        console.log("Rewound to", newTime, "seconds");
      });
      
      // Utility: extract video ID from a YouTube URL.
      function extractVideoID(url) {
        var regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
        var match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
      }
      
      // Utility: convert hh:mm:ss to seconds.
      function parseTime(timeStr) {
        var parts = timeStr.split(':').map(Number);
        if (parts.length === 3) {
          return parts[0]*3600 + parts[1]*60 + parts[2];
        } else if (parts.length === 2) {
          return parts[0]*60 + parts[1];
        } else if (parts.length === 1) {
          return parts[0];
        }
        return 0;
      }
      
      // Load a new video using the provided URL and start time.
      document.getElementById('loadUrlBtn').addEventListener('click', function() {
        var url = document.getElementById('urlInput').value.trim();
        var startTimeStr = document.getElementById('startTimeInput').value.trim();
        var startSeconds = startTimeStr ? parseTime(startTimeStr) : 0;
        if (url) {
          var videoId = extractVideoID(url);
          if (videoId) {
            player.loadVideoById({ videoId: videoId, startSeconds: startSeconds });
            liveTime = startSeconds; // reset liveTime for the new video
            console.log("Loaded video", videoId, "starting at", startSeconds, "seconds");
          } else {
            alert("Invalid YouTube URL.");
          }
        } else {
          alert("Please enter a YouTube URL.");
        }
      });
    </script>
  </body>
</html>
